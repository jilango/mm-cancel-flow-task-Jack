<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified API Testing Interface</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .tab-container {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }
        
        .tab:hover:not(.active) {
            background: #e9ecef;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
            width: 100%;
        }
        
        .test-section h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 1.3em;
        }
        
        .button-group {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .button-group h3 {
            margin: 0 0 15px 0;
            color: #495057;
        }
        
        button {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: #28a745;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1e7e34;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .success {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .error {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .debug {
            background: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            font-family: monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            overflow-x: auto;
            font-size: 13px;
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .grid {
            display: block;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .tab {
                padding: 15px;
                font-size: 14px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Unified API Testing Interface</h1>
            <p>Test your cancellation flow APIs with ease - Choose between automated tests or custom testing</p>
        </div>
        
        <div class="tab-container">
            <button class="tab active" onclick="showTab('quick-tests')">‚ö° Quick Tests</button>
            <button class="tab" onclick="showTab('custom-tests')">üîß Custom Tests</button>
        </div>
        
        <!-- Quick Tests Tab -->
        <div id="quick-tests" class="tab-content active">
            <div class="button-group">
                <h3>üöÄ Automated Test Suite</h3>
                <button class="btn-primary" onclick="runAllTests()">üöÄ Run All Tests</button>
                <button class="btn-secondary" onclick="clearAllOutputs()">üóëÔ∏è Clear All Outputs</button>
            </div>
            
            <div class="grid">
                <div class="test-section">
                    <h3>Test 1: Cancellation Start API</h3>
                    <button class="btn-primary" onclick="testStartAPI()">Test Start API</button>
                    <div id="startResult"></div>
                    <div id="startDebug" class="debug"></div>
                </div>
                
                <div class="test-section">
                    <h3>Test 2: Found Job Completion API</h3>
                    <button class="btn-primary" onclick="testCompletionAPI()">Test Completion API</button>
                    <div id="completionResult"></div>
                    <div id="completionDebug" class="debug"></div>
                </div>
                
                <div class="test-section">
                    <h3>Test 3: Analytics API</h3>
                    <button class="btn-primary" onclick="testAnalyticsAPI()">Test Analytics API</button>
                    <div id="analyticsResult"></div>
                    <div id="analyticsDebug" class="debug"></div>
                </div>
                
                <div class="test-section">
                    <h3>Test 4: Simple Fetch Test</h3>
                    <button class="btn-primary" onclick="testSimpleFetch()">Test Simple Fetch</button>
                    <div id="simpleResult"></div>
                    <div id="simpleDebug" class="debug"></div>
                </div>
                
                <div class="test-section">
                    <h3>Test 5: POST with Different Headers</h3>
                    <button class="btn-primary" onclick="testPostWithHeaders()">Test POST with Headers</button>
                    <div id="postHeadersResult"></div>
                    <div id="postHeadersDebug" class="debug"></div>
                </div>
                
                <div class="test-section">
                    <h3>Test 6: Minimal POST Test</h3>
                    <button class="btn-primary" onclick="testMinimalPost()">Test Minimal POST</button>
                    <div id="minimalPostResult"></div>
                    <div id="minimalPostDebug" class="debug"></div>
                </div>
                
                <div class="test-section">
                    <h3>Test 7: External API Test</h3>
                    <button class="btn-primary" onclick="testExternalAPI()">Test External API</button>
                    <div id="externalAPIResult"></div>
                    <div id="externalAPIDebug" class="debug"></div>
                </div>
                
                <div class="test-section">
                    <h3>Test 8: Simple Test Endpoint</h3>
                    <button class="btn-primary" onclick="testSimpleEndpoint()">Test Simple Endpoint</button>
                    <div id="simpleEndpointResult"></div>
                    <div id="simpleEndpointDebug" class="debug"></div>
                </div>
                
                <div class="test-section">
                    <h3>Test 9: Test Endpoint Direct Test</h3>
                    <button class="btn-primary" onclick="testTestEndpointDirect()">Test /api/test Direct</button>
                    <div id="testEndpointDirectResult"></div>
                    <div id="testEndpointDirectDebug" class="debug"></div>
                </div>
            </div>
        </div>
        
        <!-- Custom Tests Tab -->
        <div id="custom-tests" class="tab-content">
            <div class="button-group">
                <h3>üîß Manual Testing Interface</h3>
                <button class="btn-success" onclick="clearCustomResults()">üóëÔ∏è Clear Results</button>
            </div>
            
            <div class="grid">
                <!-- Cancellation Start API -->
                <div class="test-section">
                    <h3>üéØ Cancellation Start API</h3>
                    <div class="form-group">
                        <label for="startUserId">User ID:</label>
                        <input type="text" id="startUserId" value="550e8400-e29b-41d4-a716-446655440001" placeholder="Enter UUID">
                    </div>
                    <div class="form-group">
                        <label for="startFlowType">Flow Type:</label>
                        <select id="startFlowType">
                            <option value="standard">Standard</option>
                            <option value="found_job">Found Job</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="customStartAPI()">üöÄ Start Cancellation</button>
                    <div id="customStartResult"></div>
                </div>
                
                <!-- Found Job Completion API -->
                <div class="test-section">
                    <h3>üíº Found Job Completion API</h3>
                    <div class="form-group">
                        <label for="completionCancellationId">Cancellation ID:</label>
                        <input type="text" id="completionCancellationId" value="550e8400-e29b-41d4-a716-446655440001" placeholder="Enter UUID">
                    </div>
                    <div class="form-group">
                        <label for="completionViaMigrateMate">Found job via MigrateMate?</label>
                        <select id="completionViaMigrateMate">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="completionRolesApplied">Roles Applied:</label>
                        <select id="completionRolesApplied">
                            <option value="0">0</option>
                            <option value="1-5">1-5</option>
                            <option value="6-20">6-20</option>
                            <option value="20+">20+</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="completionCompaniesEmailed">Companies Emailed:</label>
                        <select id="completionCompaniesEmailed">
                            <option value="0">0</option>
                            <option value="1-5">1-5</option>
                            <option value="6-20">6-20</option>
                            <option value="20+">20+</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="completionCompaniesInterviewed">Companies Interviewed:</label>
                        <select id="completionCompaniesInterviewed">
                            <option value="0">0</option>
                            <option value="1-2">1-2</option>
                            <option value="3-5">3-5</option>
                            <option value="5+">5+</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="completionFeedback">Feedback (min 25 chars):</label>
                        <textarea id="completionFeedback" placeholder="Enter feedback (minimum 25 characters)">This is a valid feedback message with more than 25 characters to meet the requirement.</textarea>
                    </div>
                    <div class="form-group">
                        <label for="completionVisaLawyer">Visa Lawyer Provided?</label>
                        <select id="completionVisaLawyer">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="completionVisaType">Visa Type (if no lawyer):</label>
                        <input type="text" id="completionVisaType" placeholder="Enter visa type if no lawyer provided">
                    </div>
                    <button class="btn-primary" onclick="customCompletionAPI()">‚úÖ Complete Found Job</button>
                    <div id="customCompletionResult"></div>
                </div>
                
                <!-- Analytics API -->
                <div class="test-section">
                    <h3>üìä Analytics API</h3>
                    <button class="btn-primary" onclick="customAnalyticsAPI()">üìà Get Analytics</button>
                    <div id="customAnalyticsResult"></div>
                </div>
                
                <!-- A/B Testing Demo -->
                <div class="test-section">
                    <h3>üé≤ A/B Testing Demo</h3>
                    <p>Test the 50/50 split logic for different flows</p>
                    <button class="btn-success" onclick="runABTest()">üéØ Run A/B Test (10 iterations)</button>
                    <div id="abTestResult"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        
        // Tab switching
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
        
        // Utility functions
        function showResult(elementId, data, isSuccess) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <h4>${isSuccess ? '‚úÖ Success' : '‚ùå Error'}</h4>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
        }
        
        function showDebug(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        }
        
        // Quick Tests Functions
        async function testStartAPI() {
            const debugId = 'startDebug';
            showDebug(debugId, 'üîÑ Starting Start API test...');
            
            try {
                showDebug(debugId, 'üì§ Making POST request to /api/cancellations/start');
                
                const requestBody = { 
                    userId: '550e8400-e29b-41d4-a716-446655440001', 
                    flowType: 'found_job' 
                };
                
                showDebug(debugId, `üìù Request body: ${JSON.stringify(requestBody)}`);
                
                const response = await fetch(`${API_BASE}/api/cancellations/start`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                showDebug(debugId, `üì• Response received - Status: ${response.status}`);
                showDebug(debugId, `üìã Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, `‚úÖ Success - Data: ${JSON.stringify(data)}`);
                    showResult('startResult', data, true);
                } else {
                    const errorText = await response.text();
                    showDebug(debugId, `‚ùå Error response: ${errorText}`);
                    showResult('startResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• Fetch error: ${error.message}`);
                showDebug(debugId, `üîç Error type: ${error.constructor.name}`);
                showDebug(debugId, `üìö Error stack: ${error.stack}`);
                showResult('startResult', { error: error.message, type: error.constructor.name }, false);
            }
        }
        
        async function testCompletionAPI() {
            const debugId = 'completionDebug';
            showDebug(debugId, 'üîÑ Starting Completion API test...');
            
            try {
                showDebug(debugId, 'üì§ Making POST request to /api/cancellations/found-job/complete');
                
                const requestBody = {
                    cancellationId: '550e8400-e29b-41d4-a716-446655440001',
                    foundJobData: {
                        viaMigrateMate: 'Yes',
                        rolesApplied: '1-5',
                        companiesEmailed: '6-20',
                        companiesInterviewed: '3-5',
                        feedback: 'This is a valid feedback message with more than 25 characters to meet the requirement.',
                        visaLawyer: 'Yes'
                    }
                };
                
                showDebug(debugId, `üìù Request body: ${JSON.stringify(requestBody)}`);
                
                const response = await fetch(`${API_BASE}/api/cancellations/found-job/complete`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                showDebug(debugId, `üì• Response received - Status: ${response.status}`);
                showDebug(debugId, `üìã Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, `‚úÖ Success - Data: ${JSON.stringify(data)}`);
                    showResult('completionResult', data, true);
                } else {
                    const errorText = await response.text();
                    showDebug(debugId, `‚ùå Error response: ${errorText}`);
                    showResult('completionResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• Fetch error: ${error.message}`);
                showDebug(debugId, `üîç Error type: ${error.constructor.name}`);
                showDebug(debugId, `üìö Error stack: ${error.stack}`);
                showResult('completionResult', { error: error.message, type: error.constructor.name }, false);
            }
        }
        
        async function testAnalyticsAPI() {
            const debugId = 'analyticsDebug';
            showDebug(debugId, 'üîÑ Starting Analytics API test...');
            
            try {
                showDebug(debugId, 'üì§ Making GET request to /api/cancellations/analytics');
                
                const response = await fetch(`${API_BASE}/api/cancellations/analytics`);
                
                showDebug(debugId, `üì• Response received - Status: ${response.status}`);
                showDebug(debugId, `üìã Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, `‚úÖ Success - Data received`);
                    showResult('analyticsResult', data, true);
                } else {
                    const errorText = await response.text();
                    showDebug(debugId, `‚ùå Error response: ${errorText}`);
                    showResult('analyticsResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• Fetch error: ${error.message}`);
                showResult('analyticsResult', { error: error.message }, false);
            }
        }
        
        async function testSimpleFetch() {
            const debugId = 'simpleDebug';
            showDebug(debugId, 'üîÑ Starting Simple Fetch test...');
            
            try {
                const response = await fetch(`${API_BASE}/api/cancellations/analytics`);
                showDebug(debugId, `üì• Response received - Status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, '‚úÖ Simple fetch successful');
                    showResult('simpleResult', { message: 'Simple fetch successful', data }, true);
                } else {
                    showDebug(debugId, `‚ùå Simple fetch failed - Status: ${response.status}`);
                    showResult('simpleResult', { message: 'Simple fetch failed', status: response.status }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• Simple fetch error: ${error.message}`);
                showResult('simpleResult', { error: error.message }, false);
            }
        }
        
        async function testPostWithHeaders() {
            const debugId = 'postHeadersDebug';
            showDebug(debugId, 'üîÑ Testing POST with different headers...');
            
            try {
                // Test with minimal headers
                const response = await fetch(`${API_BASE}/api/cancellations/start`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        userId: '550e8400-e29b-41d4-a716-446655440001', 
                        flowType: 'found_job' 
                    })
                });
                
                showDebug(debugId, `üì• Response received - Status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, '‚úÖ POST with minimal headers successful');
                    showResult('postHeadersResult', data, true);
                } else {
                    const errorText = await response.text();
                    showDebug(debugId, `‚ùå POST with minimal headers failed: ${errorText}`);
                    showResult('postHeadersResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• POST with minimal headers error: ${error.message}`);
                showResult('postHeadersResult', { error: error.message }, false);
            }
        }
        
        async function testMinimalPost() {
            const debugId = 'minimalPostDebug';
            showDebug(debugId, 'üîÑ Starting minimal POST test...');
            
            try {
                showDebug(debugId, 'üì§ Making minimal POST request...');
                
                // Test with valid minimal request data
                const response = await fetch(`${API_BASE}/api/cancellations/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        userId: '550e8400-e29b-41d4-a716-446655440001',
                        flowType: 'standard'
                    })
                });
                
                showDebug(debugId, `üì• Response received - Status: ${response.status}`);
                showDebug(debugId, `üìã Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, '‚úÖ Minimal POST successful');
                    showResult('minimalPostResult', data, true);
                } else {
                    const errorText = await response.text();
                    showDebug(debugId, `‚ùå Minimal POST failed: ${errorText}`);
                    showResult('minimalPostResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• Minimal POST error: ${error.message}`);
                showDebug(debugId, `üîç Error type: ${error.constructor.name}`);
                showDebug(debugId, `üìö Error stack: ${error.stack}`);
                showResult('minimalPostResult', { error: error.message, type: error.constructor.name }, false);
            }
        }
        
        async function testExternalAPI() {
            const debugId = 'externalAPIDebug';
            showDebug(debugId, 'üîÑ Testing external API...');
            
            try {
                // Test with a simple external API
                const response = await fetch('https://httpbin.org/post', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: 'data' })
                });
                
                showDebug(debugId, `üì• External API response - Status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, '‚úÖ External API successful');
                    showResult('externalAPIResult', { message: 'External API works', data: data.json }, true);
                } else {
                    showDebug(debugId, `‚ùå External API failed - Status: ${response.status}`);
                    showResult('externalAPIResult', { message: 'External API failed', status: response.status }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• External API error: ${error.message}`);
                showResult('externalAPIResult', { error: error.message }, false);
            }
        }
        
        async function testSimpleEndpoint() {
            const debugId = 'simpleEndpointDebug';
            showDebug(debugId, 'üîÑ Testing simple test endpoint...');
            
            try {
                showDebug(debugId, 'üì§ Making POST request to /api/test');
                
                const response = await fetch(`${API_BASE}/api/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: 'data' })
                });
                
                showDebug(debugId, `üì• Response received - Status: ${response.status}`);
                showDebug(debugId, `üìã Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, '‚úÖ Simple endpoint successful');
                    showResult('simpleEndpointResult', data, true);
                } else {
                    const errorText = await response.text();
                    showDebug(debugId, `‚ùå Simple endpoint failed: ${errorText}`);
                    showResult('simpleEndpointResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• Simple endpoint error: ${error.message}`);
                showDebug(debugId, `üîç Error type: ${error.constructor.name}`);
                showResult('simpleEndpointResult', { error: error.message, type: error.constructor.name }, false);
            }
        }
        
        async function testTestEndpointDirect() {
            const debugId = 'testEndpointDirectDebug';
            showDebug(debugId, 'üîÑ Testing /api/test endpoint directly...');
            
            try {
                showDebug(debugId, 'üì§ Making POST request to /api/test');
                
                const response = await fetch(`${API_BASE}/api/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: 'data' })
                });
                
                showDebug(debugId, `üì• Response received - Status: ${response.status}`);
                showDebug(debugId, `üìã Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (response.ok) {
                    const data = await response.json();
                    showDebug(debugId, '‚úÖ /api/test endpoint successful');
                    showResult('testEndpointDirectResult', data, true);
                } else {
                    const errorText = await response.text();
                    showDebug(debugId, `‚ùå /api/test endpoint failed: ${errorText}`);
                    showResult('testEndpointDirectResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showDebug(debugId, `üí• /api/test endpoint error: ${error.message}`);
                showDebug(debugId, `üîç Error type: ${error.constructor.name}`);
                showResult('testEndpointDirectResult', { error: error.message, type: error.constructor.name }, false);
            }
        }
        
        // Custom Tests Functions
        async function customStartAPI() {
            const userId = document.getElementById('startUserId').value;
            const flowType = document.getElementById('startFlowType').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/cancellations/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, flowType })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('customStartResult', data, true);
                } else {
                    const errorText = await response.text();
                    showResult('customStartResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showResult('customStartResult', { error: error.message }, false);
            }
        }
        
        async function customCompletionAPI() {
            const cancellationId = document.getElementById('completionCancellationId').value;
            const viaMigrateMate = document.getElementById('completionViaMigrateMate').value;
            const rolesApplied = document.getElementById('completionRolesApplied').value;
            const companiesEmailed = document.getElementById('completionCompaniesEmailed').value;
            const companiesInterviewed = document.getElementById('completionCompaniesInterviewed').value;
            const feedback = document.getElementById('completionFeedback').value;
            const visaLawyer = document.getElementById('completionVisaLawyer').value;
            const visaType = document.getElementById('completionVisaType').value;
            
            const foundJobData = {
                viaMigrateMate,
                rolesApplied,
                companiesEmailed,
                companiesInterviewed,
                feedback,
                visaLawyer
            };
            
            if (visaLawyer === 'No' && visaType.trim()) {
                foundJobData.visaType = visaType;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/cancellations/found-job/complete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cancellationId, foundJobData })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('customCompletionResult', data, true);
                } else {
                    const errorText = await response.text();
                    showResult('customCompletionResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showResult('customCompletionResult', { error: error.message }, false);
            }
        }
        
        async function customAnalyticsAPI() {
            try {
                const response = await fetch(`${API_BASE}/api/cancellations/analytics`);
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('customAnalyticsResult', data, true);
                } else {
                    const errorText = await response.text();
                    showResult('customAnalyticsResult', { status: response.status, error: errorText }, false);
                }
            } catch (error) {
                showResult('customAnalyticsResult', { error: error.message }, false);
            }
        }
        
        async function runABTest() {
            const results = { standard: 0, found_job: 0, step1Offer: 0, subscriptionCancelled: 0 };
            
            for (let i = 0; i < 10; i++) {
                try {
                    const response = await fetch(`${API_BASE}/api/cancellations/start`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userId: '550e8400-e29b-41d4-a716-446655440001', 
                            flowType: 'found_job' 
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        results[data.flowType]++;
                        results[data.flowDecision]++;
                    }
                } catch (error) {
                    console.error('A/B test iteration failed:', error);
                }
                
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            showResult('abTestResult', {
                message: 'A/B Test Results (10 iterations)',
                flowTypeDistribution: {
                    standard: results.standard,
                    found_job: results.found_job
                },
                flowDecisionDistribution: {
                    step1Offer: results.step1Offer,
                    subscriptionCancelled: results.subscriptionCancelled
                }
            }, true);
        }
        
        // Utility Functions
        function runAllTests() {
            testStartAPI();
            testCompletionAPI();
            testAnalyticsAPI();
            testSimpleFetch();
            testPostWithHeaders();
            testMinimalPost();
            testExternalAPI();
            testSimpleEndpoint();
            testTestEndpointDirect();
        }
        
        function clearAllOutputs() {
            const elements = [
                'startResult', 'startDebug', 'completionResult', 'completionDebug',
                'analyticsResult', 'analyticsDebug', 'simpleResult', 'simpleDebug',
                'postHeadersResult', 'postHeadersDebug', 'minimalPostResult', 'minimalPostDebug',
                'externalAPIResult', 'externalAPIDebug', 'simpleEndpointResult', 'simpleEndpointDebug',
                'testEndpointDirectResult', 'testEndpointDirectDebug'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });
        }
        
        function clearCustomResults() {
            const elements = [
                'customStartResult', 'customCompletionResult', 'customAnalyticsResult', 'abTestResult'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });
        }
        
        // Test on page load
        window.addEventListener('load', () => {
            console.log('Unified API Testing Interface loaded');
        });
    </script>
</body>
</html>
